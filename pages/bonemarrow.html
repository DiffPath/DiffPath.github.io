<!DOCTYPE html>
<html lang="en" dir="ltr">

  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <style>
      panel-heading {
        font-family: Arial;
      }

      . {
        font-weight: normal
      }
      
      temp-header {
        font-family: Arial;
        font-size: 14px;
        font-weight: bold;
      }

    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <meta charset="utf-8">
    <title></title>

  </head>

  <body>
    <div class="jumbotron" align="center">
      <p>Bone Marrow Template</p>
    </div>

    <div class="container-fluid" id="bmTemp">

      <div class="row">
        <div class="col-sm-6">
          <div class="panel panel-primary">
            <div class="panel-heading" id='panelHead1' onselectstart="return false" style="cursor: pointer" data-header='Patient/Specimen Characteristics'><span class="glyphicon glyphicon-triangle-bottom"></span> Patient/Specimen Characteristics</div>
            <div class="panel-body" id="panel1">
              <p><b>Laterality:</b></p>
              <div class="radio" id="latAll">
                <label><input type="radio" name="laterality" value="" id="latR">Right &nbsp</label>
                <label><input type="radio" name="laterality" value="" id="latL">Left &nbsp</label>
                <label><input type="radio" name="laterality" value="" id="latN">Not Specified</label>
              </div>

              <p><b>Specimens:</b></p>
              <div class="radio">
                <label><input type="radio" name="specNum" value="" id='specFive'>All Specimens &nbsp</label>
                <label><input type="radio" name="specNum" value="" id='specFour'>All Without Peripheral Smear</label>
              </div>
              <div class="checkbox" id='specTypes'>
                <label><input type="checkbox" value="" id='specCore' name='CORE BIOPSY'>Core Biopsy &nbsp</label>
                <label><input type="checkbox" value="" id='specTouch' name='TOUCH IMPRINT'>Touch Imprint &nbsp</label>
                <label><input type="checkbox" value="" id='specClot' name='ASPIRATE CLOT'>Aspirate Clot &nbsp</label>
                <label><input type="checkbox" value="" id='specASmear' name='ASPIRATE SMEAR'>Aspirate Smear &nbsp</label>
                <label><input type="checkbox" value="" id='specPBSmear' name='PERIPHERAL BLOOD SMEAR'>Peripheral Blood Smear </label>
              </div>
              <div>
                <b>Clnical History:</b><p></p>
                Age: <input type="input" value="" id='clinAge' name='age' maxlength="3" size="3">
                Sex: <label><input type="radio" name="clinSex" value="" id='female'> Female &nbsp</label><label><input type="radio" name="clinSex" value="" id='male'> Male</label>
                <textarea rows="4" id="chText" style="width: 100%"></textarea>

              </div>
              <div>
                <button type="button" class="btn btn-primary pull-right next" id="next1">Next</button>
              </div>
            </div>
          </div>
          <div class="panel panel-primary">
            <div class="panel-heading" id='panelHead2' onselectstart="return false" style="cursor: pointer" data-header='Peripheral Blood'><span class="glyphicon glyphicon-triangle-right"></span> Peripheral Blood</div>
            <div class="panel-body" id="panel2" style="display: none"><b>Paste CBC Here:</b><textarea rows="4" id="pbText" style="width: 100%">
</textarea>
              <div>
                <button type="button" class="btn btn-primary pull-right next" id="next2">Next</button>
                <button type="button" class="btn btn-primary pull-right prev" id="prev2">Previous</button>
              </div>
            </div>
          </div>

          <div class="panel panel-primary">
            <div class="panel-heading" id='panelHead3' onselectstart="return false" style="cursor: pointer" data-header='Bone Marrow Aspirate'><span class="glyphicon glyphicon-triangle-right"></span> Aspirate</div>
            <div class="panel-body" id="panel3" style="display: none">
              <div class="checkbox">
                <label><input type="checkbox" value="" id='countCheck'>Use counter</label>
              </div>
              <div>


                <label for="fname">Blasts:</label>
                <input type="text" id="blast" maxlength="3" size="3"><label for="fname">&nbsp Promyelocytes:</label>
                <input type="text" id="promyel" maxlength="3" size="3"><label for="fname">&nbsp Myelocytes:</label>
                <input type="text" id="myel" maxlength="3" size="3">
              </div>
              <textarea rows="4" id="aspCount" style="width: 100%; display: none">
</textarea>
              <div>
                <button type="button" class="btn btn-primary pull-right next" id="next3">Next</button>
                <button type="button" class="btn btn-primary pull-right prev" id="prev3">Previous</button>
              </div>
            </div>
          </div>

          <div class="panel panel-primary">
            <div class="panel-heading" id='panelHead4' onselectstart="return false" style="cursor: pointer" data-header='Bone Marrow Core Biopsy'><span class="glyphicon glyphicon-triangle-right"></span> Core Biopsy</div>
            <div class="panel-body" id="panel4" style="display: none">Text <div>
                <button type="button" class="btn btn-primary pull-right next" id="next4">Next</button>
                <button type="button" class="btn btn-primary pull-right prev" id="prev4">Previous</button>
              </div>
            </div>
          </div>

          <div class="panel panel-primary">
            <div class="panel-heading" id='panelHead5' onselectstart="return false" style="cursor: pointer" data-header='Flow Cytometry'><span class="glyphicon glyphicon-triangle-right"></span> Flow Cytometry</div>
            <div class="panel-body" id="panel5" style="display: none">Text <button type="button" class="btn btn-primary pull-right prev" id="prev5">Previous</button>
            </div>

          </div>
        </div>
        <div class="col-sm-6">
          <temp-header>Peripheral Blood Smear</temp-header>
          <temp-header>Bone Marrow Aspirate Smear/Touch Preparation</temp-header>
          <temp-header>Bone Marrow Core Biopsy (Decalcified)/Particle Clot</temp-header>
          <temp-header>Special Stains</temp-header>
          <div class="final" id="final"></div>
          <div class="final" id="final2"></div>
        </div>
      </div>
    </div>




    <script>
      $(document).ready(function() {
        $(".panel-heading").click(function() {
          if ($(this).html().search('right') == -1) {
            $(this).html($(this).html().replace('bottom', 'right'));
            $("#" + 'panel' + $(this).attr('id').slice(9, 10)).toggle();
          } else {
            $(this).html($(this).html().replace('right', 'bottom'));
            $("#" + 'panel' + $(this).attr('id').slice(9, 10)).toggle();
          }
        })

        $('.next').click(function() {
          var nextPanel = $(this).attr('id');
          $('#' + 'panelHead' + nextPanel.slice(4, 5)).html($('#' + 'panelHead' + nextPanel.slice(4, 5)).html().replace('bottom', 'right'))
          $('#' + 'panel' + nextPanel.slice(4, 5)).hide()
          $('#' + 'panel' + (parseInt(nextPanel.slice(4, 5)) + 1)).show()
          $('#' + 'panelHead' + (parseInt(nextPanel.slice(4, 5)) + 1)).html($('#' + 'panelHead' + (parseInt(nextPanel.slice(4, 5)) + 1)).html().replace('right', 'bottom'))
        })

        $('.prev').click(function() {
          var prevPanel = $(this).attr('id');
          $('#' + 'panelHead' + prevPanel.slice(4, 5)).html($('#' + 'panelHead' + prevPanel.slice(4, 5)).html().replace('bottom', 'right'))
          $('#' + 'panel' + prevPanel.slice(4, 5)).hide()
          $('#' + 'panel' + (parseInt(prevPanel.slice(4, 5)) - 1)).show()
          $('#' + 'panelHead' + (parseInt(prevPanel.slice(4, 5)) - 1)).html($('#' + 'panelHead' + (parseInt(prevPanel.slice(4, 5)) - 1)).html().replace('right', 'bottom'))
        })

        var header = "";
        var subHeader = "";
        var cbcReport = "";
        var specCheck, latCheck = false;

        $('#latAll').change(function() {
          latCheck = true;
          if (specCheck == true) {
            createHeader()
          }
        })

        $('#specFive').change(function() {
          if ($('#specFive').prop('checked')) {
            $('#specCore').prop('checked', true);
            $('#specTouch').prop('checked', true);
            $('#specClot').prop('checked', true);
            $('#specASmear').prop('checked', true);
            $('#specPBSmear').prop('checked', true);
          }
          specCheck = true;
          if (latCheck == true) {
            createHeader()
          }
        })

        $('#specFour').change(function() {
          if ($('#specFour').prop('checked')) {
            $('#specCore').prop('checked', true);
            $('#specTouch').prop('checked', true);
            $('#specClot').prop('checked', true);
            $('#specASmear').prop('checked', true);
            $('#specPBSmear').prop('checked', false);
          }
          specCheck = true;
          if (latCheck == true) {
            createHeader()
          }
        })

        $('#specTypes').change(function() {
          if ($('#specCore').prop('checked') && $('#specTouch').prop('checked') && $('#specClot').prop('checked') && $('#specASmear').prop('checked') && $('#specPBSmear').prop('checked')) {
            $('#specFive').prop('checked', true)
          } else if ($('#specCore').prop('checked') && $('#specTouch').prop('checked') && $('#specClot').prop('checked') && $('#specASmear').prop('checked')) {
            $('#specFour').prop('checked', true)
          } else {
            $('#specFive').prop('checked', false);
            $('#specFour').prop('checked', false);
          }
          specCheck = true;
          if (latCheck == true) {
            createHeader()
          }
        })

        function createHeader() {
          header = "BONE MARROW, "
          if ($('#latR').prop('checked')) {
            header += "RIGHT" + "\n";
          } else if ($('#latL').prop('checked')) {
            header += "LEFT" + "\n";
          }
          header += "POSTERIOR ILIAC CREST; "
          var selected = [];
          $('#specTypes input:checked').each(function() {
            selected.push($(this).attr('name'));
          });
          for (var i = 0; i < selected.length; i++) {
            header += selected[i] + ", ";
          }
          header = header.slice(0, -2) + ":";
        }

        $('#chText').keyup(function() {
          subHeader = "-HISTORY OF " + $('#chText').val().toUpperCase();
          runFinal();
        })

        $('#pbText').change(function() {
          var cbcFinal = [];
          var cbcToggle = 0;
          var cbcLines = "";
          var cbcUnit = "";
          var collectedDate = "";
          var cbcText = ""
          var cbcHeader = "The following CBC is from ______ and was performed at Northwestern Memorial Hospital" + "<p>"
          var cbc = ["WBC", "HGB", "HCT", "MCV", "RDW", "PLT"];
          var cbcLines = $('#pbText').val().split("\n")
          for (var i = 0; i < cbcLines.length; i++) {
            cbcFinal.push(cbcLines[i].split("\t"))
          }
          for (var i = 0; i < cbcFinal.length; i++) {
            for (var j = 0; j < cbcFinal[i].length; j++) {
              if (cbcFinal[i][j].indexOf("Specimen Collected:") != -1) {
                var cbcTemp = cbcFinal
                collectedDate = cbcTemp[i][j].split(" ")[2]
                cbcHeader = "The following CBC is from " + collectedDate + " and was performed at Northwestern Memorial Hospital" + "<p>"
              }
            }
            if (cbc.indexOf(cbcFinal[i][0].replace(/\s/g, '')) != -1) {

              for (var j = 0; j < cbcFinal[i].length; j++) {
                if (cbcFinal[i][j].indexOf("-") != -1) {
                  cbcUnit = " " + cbcFinal[i][j].replace(/[\d\.\s-]/g, '');
                  if (cbcUnit.indexOf("%") != -1) {
                    cbcUnit = cbcUnit.replace(/\s/g, '');
                  }
                }
                if (cbcFinal[i][j].indexOf("-") == -1 && cbcToggle == 0 && /\d/.test(cbcFinal[i][j])) {
                  if (cbcFinal[i][0].replace(/\s/g, '') == cbc[cbc.length - 1]) {
                    cbcText += cbcFinal[i][0].replace(/\s/g, '') + " " + cbcFinal[i][j].replace(/[^\d.-]/g, '') + cbcUnit + ".";
                    cbcToggle = 1;

                  } else {

                    cbcText += cbcFinal[i][0].replace(/\s/g, '') + " " + cbcFinal[i][j].replace(/[^\d.-]/g, '') + cbcUnit + "; ";
                    cbcToggle = 1;
                  }

                }
              }
            }
            cbcToggle = 0;
          }
          cbcReport = cbcHeader + cbcText
          runFinal();
        })

        $('#countCheck').change(function() {
          $('#aspCount').toggle();
        })

        $('#bmTemp').change(function() {
          runFinal();
        })

        function runFinal() {
          $("#final").html(header + "<p>" + subHeader + "<p>" + cbcReport);
        }

      });

    </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  </body>

</html>
