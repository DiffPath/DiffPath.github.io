<!DOCTYPE html>
<html lang="en" dir="ltr">

  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://kit.fontawesome.com/f6f9c2cc49.js" crossorigin="anonymous"></script>
    <style>
      ::-webkit-input-placeholder {
        color: black;
        opacity: 1 !important;
      }

      input:focus::placeholder {
        color: transparent;
      }

      div {
        font-family: Arial;
        font-size: 11pt;
      }

      br {
        font-family: Arial;
        font-size: 11pt;
      }

      input {
        display: inline-block;
        padding: 0px 0px;
        line-height: 80%;
      }

      label {
        font-weight: Normal;
        padding-right: 15px
      }

      table {
        border-collapse: collapse;
        font-family: Arial;
        table-layout: fixed;
        font-size: 11pt;
      }

      th,
      td {
        border: 1px solid black;
        vertical-align: text-top;

      }

      table.padleft td {
        padding-left: 10px;
      }

      table.padleft th {
        padding-left: 10px;
      }
      

      .noborder {
        border: none;
      }

      .center {
        text-align: center;
      }

      .banner {
        background-color: rgb(51, 122, 183);
        text-align: center;
        color: white;
        font-size: 20pt;
        font-weight: bold;
        position: -webkit-sticky;
        position: sticky;
        top: 0;
        z-index: 1;
        padding-left: 120px
      }
      
      .labelnopad {
        padding-right: 0px;
      }

      .pad {
        padding: 10px;
      }

      .top {
        padding-top: 15px;
      }

      .left {
        padding-left: 15px;
      }

      .bottom {
        padding-bottom: 15px;
      }

      .right {
        padding-right: 15px;
      }

      .h1 {
        font-size: 14pt;
        font-family: Arial;
        color: red;
        text-decoration: underline;
        font-style: italic;
        font-weight: bold;
        margin: 0px;
      }

      .h2 {
        font-size: 14pt;
        font-family: Arial;
        font-weight: bold;
        margin: 0px;
      }

      .smallText {
        font-size: 8pt;
        font-family: Arial;
      }

      .header {
        font-size: 11pt;
        font-family: Arial;
        font-weight: bold;
        margin: 0px;
      }

      .rightalign {
        float: right;
        padding: 8px;
        margin: auto;
      }

      .icon:hover {
        color: rgb(200, 200, 200);
      }

      }

    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <meta charset="utf-8">
    <title></title>

  </head>

  <body>
    <div class="container-fluid" id="bmTemp">
      <div class="row banner"><span>Bone Marrow Template</span>
        <i class="icon fas fa-cog rightalign rightpanelbutton" id='settingsButton'></i>
        <i class="icon far fa-question-circle rightalign rightpanelbutton" id="helpButton"></i>
        <i class="icon fas fa-book rightalign rightpanelbutton" id='educationButton'></i>
        <i class="icon fas fa-list rightalign rightpanelbutton" id="templateButton"></i>
      </div>
      <div class="row top">
        <div class="col-xs-6">
          <div class="panel panel-primary">
            <div class="panel-heading" id='panelHead1' onselectstart="return false" style="cursor: pointer" data-header='Patient/Specimen Characteristics'><span class="glyphicon glyphicon-triangle-bottom"></span> Patient/Specimen Characteristics</div>
            <div class="panel-body" id="panel1">
              <p><b>Laterality:</b></p>
              <div class="radio" id="latAll">
                <label><input type="radio" name="laterality" value="" id="latR">Right</label>
                <label><input type="radio" name="laterality" value="" id="latL">Left</label>
                <label><input type="radio" name="laterality" value="" id="latB">Bilateral</label>
                <label><input type="radio" name="laterality" value="" id="latN">Not Specified</label>
              </div>

              <p><b>Specimens:</b></p>
              <div class="radio">
                <label><input type="radio" name="specNum" value="" id='specFive'>All Specimens</label>
              </div>
              <div class="checkbox" id='specTypes'>
                <div class="row left">
                  <label><input type="checkbox" value="" id='specPBSmear'>Peripheral Blood Smear </label>
                </div>
                <div class="row left">
                  <label><input type="checkbox" value="" id='specASmear'>Aspirate Smear</label>
                  <span id="aspDiv" style="display: none"><input type="input" value="" id='aspSize' name='age' maxlength="3" size="2"> cc
                  </span>
                </div>
                <div class="row left">
                  <label><input type="checkbox" value="" id='specClot'>Particle Clot</label>
                </div>
                <div class="row left">

                  <label><input type="checkbox" value="" id='specCore' name='CORE BIOPSY'>Core Biopsy</label>
                  <span id="coreDiv" style="display: none">
                    <input type="input" value="" id='coreSize1' maxlength="3" size="2"> cm &nbsp
                    <input type="input" value="" id='coreSize2' maxlength="3" size="2"> cm (if present)
                  </span>
                </div>
                <div class="row left bottom">

                  <label><input type="checkbox" value="" id='specTouch'>Touch Imprint</label>
                </div>
                <div class="row left">
                  <label><input type="checkbox" value="" id='specFlow'>Flow Cytometry</label>
                </div>
                <div class="row left">
                  <label><input type="checkbox" value="" id='specGen'>Cytogenetics</label>
                </div>
                <div class="row left">
                  <label><input type="checkbox" value="" id='specFISH'>FISH</label><input type="text" list="fish" id='fishList' style="display: none">
                  <datalist id="fish">
                    <option value="AML"></option>
                    <option value="Myeloma"></option>
                    <option value="MDS/MPN"></option>
                  </datalist>
                </div>
                <div class="row left bottom">
                  <label><input type="checkbox" value="" id='specMolec'>Molecular</label><input type="text" list='molec' id='molecList' style="display: none">
                  <datalist id="molec">
                    <option value="NGS"></option>
                  </datalist>
                </div>
                <div>
                  <b>Clinical History:</b>
                  <p></p>
                  Age: <input type="input" value="" id='clinAge' name='age' maxlength="3" size="3"><br><br> <textarea rows="4" id="chText" style="width: 100%"></textarea>
                </div>
                <div>
                  <button type="button" class="btn btn-primary pull-right next" id="next1">Next</button>
                </div>
              </div>
            </div>
          </div>
          <div class="panel panel-primary">
            <div class="panel-heading" id='panelHead2' onselectstart="return false" style="cursor: pointer" data-header='Peripheral Blood'><span class="glyphicon glyphicon-triangle-right"></span> Peripheral Blood</div>
            <div class="panel-body" id="panel2" style="display: none"><b>Paste CBC Here:</b><textarea rows="1" id="pbCBC" style="width: 100%">
</textarea>
              <div class="row">
                <div class="col-xs-9" id="pbCountTable">
                  <table class="center" style="width:100%">
                    <tr>
                      <td><label id="pbLabel7" class="pbCellType labelnopad"><b>7.</b> Neuts</label><br>
                        <input type="text" id="pb7" maxlength="5" size="3"></td>
                      <td><label id="pbLabel8" class="pbCellType labelnopad"><b>8.</b> Lymphs</label><br>
                        <input type="text" id="pb8" maxlength="5" size="3"></td>
                      <td><label id="pbLabel9" class="pbCellType labelnopad"><b>9.</b> Mono</label><br>
                        <input type="text" id="pb9" maxlength="5" size="3"></td>
                    </tr>
                    <tr>
                      <td><label id="pbLabel4" class="pbCellType labelnopad"><b>4.</b> Eos</label><br>
                        <input type="text" id="pb4" maxlength="5" size="3"></td>
                      <td><label id="pbLabel5" class="pbCellType labelnopad"><b>5.</b> Baso</label><br>
                        <input type="text" id="pb5" maxlength="5" size="3"></td>
                      <td><label id="pbLabel6" class="pbCellType labelnopad"><b>6.</b> Plasma</label><br>
                        <input type="text" id="pb6" maxlength="5" size="3"></td>
                    </tr>
                    <tr>
                      <td><label id="pbLabel1" class="pbCellType labelnopad"><b>1.</b> NRBCs</label><br>
                        <input type="text" id="pb1" maxlength="5" size="3"></td>
                      <td><label id="pbLabel2" class="pbCellType labelnopad"><b>2.</b> Atypical</label><br>
                        <input type="text" id="pb2" maxlength="5" size="3"></td>
                      <td><label id="pbLabel3" class="pbCellType labelnopad"><b>3. </b><input type="input" value="" placeholder="Other" size="3"></label><br>
                        <input type="text" id="pb3" maxlength="5" size="3"></td>
                    </tr>
                    <tr>
                      <td class='noborder'></td>
                      <td><label id="pbLabel0" class="pbCellType labelnopad"><b>0.</b> Blasts</label><br>
                        <input type="text" id="pb0" maxlength="5" size="3"></td>
                      <td class='noborder'></td>
                    </tr>
                  </table>
                </div>
                <div class="col-xs-3">
                  <div>
                    <label for="fname">Current Count:</label><br>
                    <input type="text" id="pbCCount" maxlength="5" size="3">
                  </div>
                  <div>
                    <label for="fname">Desired Count:</label><br>
                    <input type="text" id="pbDCount" list="pbDList" maxlength="4" size="3" placeholder="200"><datalist id="pbDList">
                      <option value="100"></option>
                      <option value="200"></option>
                      <option value="300"></option>
                      <option value="400"></option>
                      <option value="500"></option>
                    </datalist>
                  </div>
                  <div>
                    <label for="fname">Total %</label><br>
                    <input type="text" id="pbTotalPercent" maxlength="6" size="3">
                  </div>
                </div>
              </div>
              <b>Count Here:</b><textarea rows="4" id="pbCount" style="width: 100%">
</textarea>
              <div>
                <b>Performed By: </b><input type="input" value="" id='pbPerformed'>
              </div>
              <div id="pbDescriptors">
                <b>RBCs:</b> <label><input type="radio" name="rbc" value="" id='rbcNL'> Unremarkable</label><label><input type="checkbox" name="rbc" value="" id='rbcPC'> Polychromasia</label><label><input type="checkbox" name="rbc" value="" id='rbcAP'> Anisopoikilocytosis</label>
                <div id="anisoDiv" style="display: none">

                </div>
                <div>
                  <b>Neutrophils: </b><label><input type="radio" name="neut" value="" id='neutNL'> Unremarkable </label>
                  <label><input type="checkbox" class="pbNeut" name="neut" value="" id='neutTC'> Toxic change</label><label><input type="checkbox" class="pbNeut" name="neut" value="" id='neutLS'> Left shift</label>
                </div>
                <div>
                  <b>Platelets: </b><label><input type="radio" name="plt" value="" id='pltNL'> Unremarkable</label>
                  <label><input type="radio" name="plt" value="" id='pltLP'> Occasional large platelets</label>

                </div>
              </div>
              <b>Peripheral Blood Text:</b><textarea rows="4" id="pbText" style="width: 100%">
</textarea>
              <div>
                <button type="button" class="btn btn-primary pull-right next" id="next2">Next</button>
                <button type="button" class="btn btn-primary pull-right prev" id="prev2">Previous</button>
              </div>
            </div>
          </div>
          <div class="panel panel-primary">
            <div class="panel-heading" id='panelHead3' onselectstart="return false" style="cursor: pointer" data-header='Bone Marrow Aspirate'><span class="glyphicon glyphicon-triangle-right"></span> Aspirate Smear</div>
            <div class="panel-body" id="panel3" style="display: none">
              <div class="row">
                <div class="col-xs-9" id="aspCountTable">
                  <table class="center" style="width:100%">
                    <tr>
                      <td><label id="aspLabel7" class="aspCellType"><b>7.</b> Neuts</label><br>
                        <input type="text" id="asp7" maxlength="5" size="3"></td>
                      <td><label id="aspLabel8" class="aspCellType"><b>8.</b> Eos</label><br>
                        <input type="text" id="asp8" maxlength="5" size="3"></td>
                      <td><label id="aspLabel9" class="aspCellType"><b>9.</b> Mono</label><br>
                        <input type="text" id="asp9" maxlength="5" size="3"></td>
                    </tr>
                    <tr>
                      <td><label id="aspLabel4" class="aspCellType"><b>4.</b> NRBCs</label><br>
                        <input type="text" id="asp4" maxlength="5" size="3"></td>
                      <td><label id="aspLabel5" class="aspCellType"><b>5.</b> Lymphs</label><br>
                        <input type="text" id="asp5" maxlength="5" size="3"></td>
                      <td><label id="aspLabel6" class="aspCellType"><b>6.</b> Plasma</label><br>
                        <input type="text" id="asp6" maxlength="5" size="3"></td>
                    </tr>
                    <tr>
                      <td><label id="aspLabel1" class="aspCellType"><b>1.</b> Baso</label><br>
                        <input type="text" id="asp1" maxlength="5" size="3"></td>
                      <td><label id="aspLabel2" class="aspCellType"><b>2.</b> Atypical</label><br>
                        <input type="text" id="asp2" maxlength="5" size="3"></td>
                      <td><label id="aspLabel3" class="aspCellType"><b>3.</b> Other</label><br>
                        <input type="text" id="asp3" maxlength="5" size="3"></td>
                    </tr>
                    <tr>
                      <td class="noborder"></td>
                      <td><label id="aspLabel0" class="aspCellType"><b>0.</b> Blasts</label><br>
                        <input type="text" id="asp0" maxlength="5" size="3"></td>
                      <td class="noborder"></td>
                    </tr>
                  </table>
                </div>
                <div class="col-xs-3">
                  <div>
                    <label for="fname">Current Count:</label><br>
                    <input type="text" id="aspCCount" maxlength="4" size="3">
                  </div>
                  <div>
                    <label for="fname">Desired Count:</label><br>
                    <input type="text" id="aspDCount" list="aspDList" maxlength="4" size="3" placeholder="500"><datalist id="aspDList">
                      <option value="100"></option>
                      <option value="200"></option>
                      <option value="300"></option>
                      <option value="400"></option>
                      <option value="500"></option>
                    </datalist>
                  </div>
                  <div>
                    <label for="fname">M:E ratio:</label><br>
                    <input type="text" id="meRatio" maxlength="4" size="3">
                  </div>
                  <div>
                    <label for="fname">Total %</label><br>
                    <input type="text" id="aspTotalPercent" maxlength="6" size="3">
                  </div>
                </div>
              </div>
              <b>Count Here:</b>
              <textarea rows="4" id="aspCount" style="width: 100%">
</textarea>
              <div id="aspirateDiv">
                <b>Adequacy:</b> <label><input type="radio" name="adequacy" value="" id='aspAdequate'> Adequate</label><label><input type="radio" value="" name="adequacy" id='aspSuboptimal'> Suboptimal</label><label><input type="radio" value="" name="adequacy" id='aspInadequate'> Inadequate</label>
                <div>
                  <b>Descriptors:</b> <label><input type="checkbox" value="" id='aspHemodilute'> Hemodilute</label><label><input type="checkbox" value="" id='aspAcellular'> Virtually acellular</label><br>
                </div>
                <div>
                  <b>Erythroid Precursors: </b><label><input type="checkbox" value="" id='aspBlastNI' name='blasts'> Not increased</label><label><input type="checkbox" value="" id='aspBlastInc' name='blasts'> Increased</label>
                </div>
                <div>
                  <b>Myeloid Precursors: </b><label><input type="checkbox" value="" id='aspMyeloid' name='blasts'> Not increased</label><label><input type="checkbox" value="" id='aspBlastInc' name='blasts'> Increased</label>
                </div>
                <div>
                  <b>Megakaryocytes:</b> <label><input type="radio" value="" id='aspMegAdeq' name='megs'> Adequate</label><label><input type="radio" value="" id='aspMegDec' name='megs'> Decreased</label><label><input type="radio" value="" id='aspMegInc' name='megs'> Increased</label>
                  <div><label><input type="radio" value="" id='aspMegNL'> Unremarkable</label><label><input type="checkbox" value="" id='aspMegHF'> Hyplobated forms</label><label><input type="checkbox" value="" id='aspMegSN'> Separation of nuclei</label></div>
                </div>
                <div>
                  <b>Blasts: </b><label><input type="checkbox" value="" id='aspBlastNI' name='blasts'> Not increased</label><label><input type="checkbox" value="" id='aspBlastInc' name='blasts'> Increased</label>
                </div>
              </div>
              <b>Aspirate Smear/Touch Preparation Text:</b><textarea rows="4" id="aspText" style="width: 100%">
</textarea>
              <div id='ironStainDiv'>
                <label><input type="checkbox" checked='true' id='ironStain'> Iron Stain</label><br>
                <b>Storage Iron: </b>
                <label><input type="radio" name='ironQuant' id='ironStainInc'> Increased</label>
                <label><input type="radio" name='ironQuant' id='ironStainAdeq'> Adequate</label>
                <label><input type="radio" name='ironQuant' id='ironStainDec'> Decreased</label><br>
                <b>Ring Sideroblasts: </b>
                <label><input type="radio" name='ring' id='ringAbsent'> Absent</label>
                <label><input type="radio" name='ring' id='ringPresent'> Present</label>
              </div>


              <div>
                <button type="button" class="btn btn-primary pull-right next" id="next3">Next</button>
                <button type="button" class="btn btn-primary pull-right prev" id="prev3">Previous</button>
              </div>
            </div>
          </div>
          <div class="panel panel-primary">
            <div class="panel-heading" id='panelHead4' onselectstart="return false" style="cursor: pointer" data-header='Bone Marrow Core Biopsy'><span class="glyphicon glyphicon-triangle-right"></span> Core Biopsy</div>
            <div class="panel-body" id="panel4" style="display: none">Text <div>
                <button type="button" class="btn btn-primary pull-right next" id="next4">Next</button>
                <button type="button" class="btn btn-primary pull-right prev" id="prev4">Previous</button>
              </div>
            </div>
          </div>
          <div class="panel panel-primary">
            <div class="panel-heading" id='panelHead5' onselectstart="return false" style="cursor: pointer" data-header='Flow Cytometry'><span class="glyphicon glyphicon-triangle-right"></span> Flow Cytometry</div>
            <div class="panel-body" id="panel5" style="display: none"><i class="icon far fa-question-circle rightalign" id="flowHelp"></i><textarea rows="4" id="fcText" style="width: 100%"></textarea><button type="button" class="btn btn-primary pull-right prev" id="prev5">Previous</button>
            </div>

          </div>
        </div>
        <div class="col-xs-6">
          <div id="helpScreen" class="rightpanel" style="display: none">
            This is the help screen for people that need help.
          </div>
          <div id="flowHelpScreen" class="rightpanel" style="display: none">
            <div class="header">
              Flow Templates
            </div>
            Chronic:
          </div>
          <div id="settingsScreen" class="rightpanel" style="display: none">
            <div>
              Performed By: <input type="input" value="" id='savePerformed'>
            </div>
            <div>
              Theme Color: <input type="color" id="themeColor" name="favcolor" value=#3379b7>
            </div>            <div>
              Peripheral Blood Count Orientation: (Under Construction Do Not Use)
              <table class="center" style="width:100%">
                    <tr>
                      <td><b>7. </b><input type="text" id = "pbSave7" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                      <td><b>8. </b><input type="text" id = "pbSave8" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                      <td><b>9. </b><input type="text" id = "pbSave9" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                    </tr>
                    <tr>
                    <td><b>4. </b><input type="text" id = "pbSave4" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                    <td><b>5. </b><input type="text" id = "pbSave5" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                    <td><b>6. </b><input type="text" id = "pbSave6" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                    </tr>
                    <tr>
                      <td><b>1. </b><input type="text" id = "pbSave1" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                      <td><b>2. </b><input type="text" id = "pbSave2" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                      <td><b>3. </b><input type="text" id = "pbSave3" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                    </tr>
                    <tr>
                      <td class='noborder'></td>
                      <td><b>0.</b><input type="text" id = "pbSave0" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                      <td class='noborder'></td>
                    </tr>
                  </table>
                  <datalist id="cellTypeList">
                      <option value="Atypical"></option>
                      <option value="Baso"></option>
                      <option value="Blasts"></option>
                      <option value="Eos"></option>
                      <option value="Lymphs"></option>
                      <option value="Mono"></option>
                      <option value="Neuts"></option>
                      <option value="NRBCs"></option>
                      <option value="Other"></option>
                      <option value="Plasma"></option>
                 </datalist>
            </div>
            <div>
              Aspirate Smear Count Orientation: (Under Construction Do Not Use)
              <table class="center" style="width:100%">
                    <tr>
                      <td><b>7. </b><input type="text" id = "aspSave7" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                      <td><b>8. </b><input type="text" id = "aspSave8" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                      <td><b>9. </b><input type="text" id = "aspSave9" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                    </tr>
                    <tr>
                    <td><b>4. </b><input type="text" id = "aspSave4" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                    <td><b>5. </b><input type="text" id = "aspSave5" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                    <td><b>6. </b><input type="text" id = "aspSave6" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                    </tr>
                    <tr>
                      <td><b>1. </b><input type="text" id = "aspSave1" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                      <td><b>2. </b><input type="text" id = "aspSave2" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                      <td><b>3. </b><input type="text" id = "aspSave3" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                    </tr>
                    <tr>
                      <td class='noborder'></td>
                      <td><b>0.</b><input type="text" id = "aspSave0" class = "pbCellTypeSave" list="cellTypeList" size="6"></td>
                      <td class='noborder'></td>
                    </tr>
                  </table>
                  <datalist id="cellTypeList">
                      <option value="Atypical"></option>
                      <option value="Baso"></option>
                      <option value="Blasts"></option>
                      <option value="Eos"></option>
                      <option value="Lymphs"></option>
                      <option value="Mono"></option>
                      <option value="Neuts"></option>
                      <option value="NRBCs"></option>
                      <option value="Other"></option>
                      <option value="Plasma"></option>
                 </datalist>
            </div><br>

            <button type="button" class="btn btn-primary" id="saveAll">Save Settings</button>
          </div>
          <div id="educationScreen" class="rightpanel" style="display: none">
            This will be where educational references will be.
          </div>
          <div id="templateScreen" class="rightpanel" style="">
            <div class="final" id="final2"></div>
            <div>
              <button type="button" class="btn btn-primary copy" id="everythingCopy">Copy All</button> <button type="button" class="btn btn-primary copy" id="finalCopy">Copy Final</button><button type="button" class="btn btn-primary copy" id="clinicalCopy">Copy Clinical</button><button type="button" class="btn btn-primary copy" id="microscopicCopy">Copy Microscopic</button><button type="button" class="btn btn-primary copy" id="grossCopy">Copy Gross</button>
            </div>
            <div id="everythingCopyText" class='top'>
              <div id="final" style="display: none">
                <div class="h1">
                  Final Diagnosis
                </div>
                <div id="finalCopyText">
                  <div class="header" id="header">
                  </div>
                </div>
              </div>
              <div id="clinical" style="display: none">
                <div class="h1">
                  Clinical Information
                </div>
                <div id="clinicalCopyText">

                  <div id="clinicalHistory">
                  </div>
                  <div id="clinicalCBC" style="display: none">
                  </div>

                </div>
              </div>
              <div id="microscopic" style="display: none">
                <div class="h1">
                  Microscopic Description
                </div>
                <div id="microscopicCopyText">
                  <div id="diff" class='header' style="display: none">
                    Differential Count<br><br>
                  </div>
                  <div id='pbTable' style="display: none" class='left'>
                    <table class='padleft' style="width:425px">
                      <tr>
                        <th style="width:50%" id="pbTableCountHeader"></th>
                        <th style="width:17%">Result</th>
                        <th style="width:33%">Reference Range</th>
                      </tr>
                      <tr id="pbBlastRow" style="display: none">
                        <td>Blasts</td>
                        <td id="pbBlastsTable"></td>
                        <td>0</td>
                      </tr>
                      <tr>
                        <td>Neutrophils</td>
                        <td id="pbNeutsTable"></td>
                        <td>34 - 73%</td>
                      </tr>
                      <tr>
                        <td>Lymphocytes</td>
                        <td id="pbLymphsTable"></td>
                        <td>15 - 50%</td>
                      </tr>
                      <tr>
                        <td>Monocytes</td>
                        <td id="pbMonoTable"></td>
                        <td>5 - 15%</td>
                      </tr>
                      <tr>
                        <td>Eosinophils</td>
                        <td id="pbEosTable"></td>
                        <td>0 - 8%</td>
                      </tr>
                      <tr>
                        <td>Basophils</td>
                        <td id="pbBasoTable"></td>
                        <td>0 - 2%</td>
                      </tr>
                      <tr id="pbPlasmaRow" style="display: none">
                        <td>Plasma Cells</td>
                        <td id="pbPlasmaTable"></td>
                        <td>0</td>
                      </tr>
                      <tr id="pbNRBCRow" style="display: none">
                        <td>NRBC's/100 WBC</td>
                        <td id="pbNRBCsTable"></td>
                        <td>0</td>
                      </tr>
                    </table>
                    <br>
                  </div>
                  <div id='aspTable' style="display: none" class='left'>
                    <table class='padleft' style="width:425px">
                      <tr>
                        <th style="width:50%" id="aspTableCountHeader"></th>
                        <th style="width:17%">Result</th>
                        <th style="width:33%">Reference Range</th>
                      </tr>
                      <tr>
                        <td>Blasts</td>
                        <td id="aspBlastsTable"></td>
                        <td>0 – 3%</td>
                      </tr>
                      <tr>
                        <td>Neutrophils & Precursors</td>
                        <td id="aspNeutsTable"></td>
                        <td>33 – 63%</td>
                      </tr>
                      <tr>
                        <td>Eosinophils & Precursors</td>
                        <td id="aspEosTable"></td>
                        <td>1 – 5%</td>
                      </tr>
                      <tr>
                        <td>Basophils & Precursors</td>
                        <td id="aspBasoTable"></td>
                        <td>0 – 1%</td>
                      </tr>
                      <tr>
                        <td>Monocytes</td>
                        <td id="aspMonoTable"></td>
                        <td>0 – 2%</td>
                      </tr>
                      <tr>
                        <td>Lymphocytes</td>
                        <td id="aspLymphsTable"></td>
                        <td>10 – 15%</td>
                      </tr>
                      <tr>
                        <td>Plasma Cells</td>
                        <td id="aspPlasmaTable"></td>
                        <td>0 – 1%</td>
                      </tr>
                      <tr>
                        <td>Erythroid Precursors</td>
                        <td id="aspNRBCsTable"></td>
                        <td>15 – 27%</td>
                      </tr>
                      <tr>
                        <td>M:E Ratio</td>
                        <td id="aspMETable"></td>
                        <td>1.5 - 3.3</td>
                      </tr>
                    </table>
                    <br>
                  </div>
                  <div id='performedText'>
                  </div>
                  <div id="peripheralBlood" style="display: none">
                    <div class="h2">
                      Peripheral Blood Smear
                    </div>
                    <div id="bloodText">
                    </div>
                  </div>
                  <div id="aspirateSmear" style="display: none">
                    <div class="h2">
                      Bone Marrow Aspirate Smear/Touch Preparation
                    </div>
                    <div id="aspirateText" style="display: none">
                    </div>
                  </div>
                  <div id="specialStains" style="display: none">
                    <div class="h2">
                      Special Stains
                    </div>
                    <div id="specialStainsTable">
                      <table class='padleft' style="width:425px">
                        <tr>
                          <td style="width:40%">Prussian blue</td>
                          <td id="ssIronTable" style="width:60%"></td>
                        </tr>
                      </table>
                    </div>
                    <br>
                    <div id="controlText" class="smallText">
                      The positive control(s) showed appropriate staining.
                    </div><br>
                  </div>
                </div>
              </div>
              <div id="gross" style="display: none">
                <div class="h1">
                  Specimen/Gross Description
                </div>
                <div id="grossCopyText">
                  The specimen consists of the following:
                  <div id="grossText">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>



    <script>
      $(document).ready(function() {
        var performedName = localStorage.getItem("performedName");
        var themeColor = localStorage.getItem("themeColor");
        if (performedName != null && performedName != "null") {
          $('#pbPerformed').val(performedName);
          $('#savePerformed').val(performedName);
        }
        if (themeColor != null && themeColor != "null") {
          changeTheme(themeColor);
          $('#themeColor').val(themeColor)
        }
        
        var pbTypeList = JSON.parse(localStorage.getItem("pbTypeList"));
        if (pbTypeList != null && pbTypeList != "null") {
          pbTypeListChange(pbTypeList);
        } else {
        pbTypeList = ['Blasts', 'NRBCs', 'Atypical', 'Other', 'Eos', 'Baso', 'Plasma', 'Neuts', 'Lymphs', 'Mono'];
         pbTypeListChange(pbTypeList);
        }

        var countAudio = 'https://diffpath.github.io/media/Count-Click2.wav';
        var hundredAudio = 'https://diffpath.github.io/media/100-Soothing.wav';
        var finishedAudio = 'https://diffpath.github.io/media/Complete-Nice.mp3';
        var aspTypeList = ['Blasts', 'Baso', 'Atypical', 'Other', 'NRBCs', 'Lymphs', 'Plasma', 'Neuts', 'Eos', 'Mono'];
        var header = '';
        var subHeader = '';
        var cbcReport = '';
        var specCheck, latCheck = false;
        var wbc, wbcHigh, wbcLow, hgb, hgbHigh, hgbLow, mcv, mcvHigh, mcvLow, plt, pltHigh, pltLow, neutLow, neutHigh, lymphLow, lymphHigh, monoLow, monoHigh
        var anisoVar = '';
        var anisoIDList = [];
        var anisoOptionList = [];
        var finalAnisoList = [];
        var lastPanel = ''
        window.keypressed = {};

        $('.rightpanelbutton').click(function() {
          showPanel(this.id.replace('Button', 'Screen'))
        })
        
        function pbTypeListChange(pbTypeList){
        $('.pbCellTypeSave').each(function(){
        $(this).attr('placeholder',pbTypeList[this.id.replace('pbSave','')])
        })
        
        $('.pbCellType').each(function(){
        $(this).html('<b>' + this.id.replace('pbLabel','') + ". </b>" + pbTypeList[this.id.replace('pbLabel','')])
        })       
        }

        function showPanel(panelId) {
          $(".rightpanel").each(function() {
            if (this.id == panelId) {
              $("#" + this.id).show();
            } else {
              $("#" + this.id).hide()
            }
          })
        }
        
         function togglePanel(panelId) {
         if ($('#' + panelId).attr('style').indexOf('none') != -1) {
            $(".rightpanel").each(function() {
            if ($('#' + this.id).attr('style').indexOf('none') == -1) {
            	lastPanel = this.id
              $("#" + this.id).hide();
              $('#' + panelId).show();
            } 
              
            }
          )
         } else {
         $('#' + panelId).hide();
         $('#' + lastPanel).show();
         }

        }

        $(".panel-heading").click(function() {
          if ($(this).html().search('right') == -1) {
            $(this).html($(this).html().replace('bottom', 'right'));
            $("#" + 'panel' + $(this).attr('id').slice(9, 10)).toggle();
          } else {
            $(this).html($(this).html().replace('right', 'bottom'));
            $("#" + 'panel' + $(this).attr('id').slice(9, 10)).toggle();
          }
        })

        $('.next').click(function() {
          var nextPanel = $(this).attr('id');
          $('#' + 'panelHead' + nextPanel.slice(4, 5)).html($('#' + 'panelHead' + nextPanel.slice(4, 5)).html().replace('bottom', 'right'))
          $('#' + 'panel' + nextPanel.slice(4, 5)).hide()
          $('#' + 'panel' + (parseInt(nextPanel.slice(4, 5)) + 1)).show()
          $('#' + 'panelHead' + (parseInt(nextPanel.slice(4, 5)) + 1)).html($('#' + 'panelHead' + (parseInt(nextPanel.slice(4, 5)) + 1)).html().replace('right', 'bottom'))
        })

        $('.prev').click(function() {
          var prevPanel = $(this).attr('id');
          $('#' + 'panelHead' + prevPanel.slice(4, 5)).html($('#' + 'panelHead' + prevPanel.slice(4, 5)).html().replace('bottom', 'right'))
          $('#' + 'panel' + prevPanel.slice(4, 5)).hide()
          $('#' + 'panel' + (parseInt(prevPanel.slice(4, 5)) - 1)).show()
          $('#' + 'panelHead' + (parseInt(prevPanel.slice(4, 5)) - 1)).html($('#' + 'panelHead' + (parseInt(prevPanel.slice(4, 5)) - 1)).html().replace('right', 'bottom'))
        })

        $('#latAll').change(function() {
          latCheck = true;
          if (specCheck == true) {
            grossDescription();
          }
        })

        $('#specFive').change(function() {
          if ($('#specFive').prop('checked')) {
            $('#specCore').prop('checked', true);
            $('#specTouch').prop('checked', true);
            $('#specClot').prop('checked', true);
            $('#specASmear').prop('checked', true);
            $('#specPBSmear').prop('checked', true);
            $('#specFlow').prop('checked', true);
            $('#specGen').prop('checked', true);
            $('#specFISH').prop('checked', true);
            $('#specMolec').prop('checked', true);
          }
          showDivs();
          specCheck = true;
          if (latCheck == true) {
            grossDescription();
          }
        })

        $('.copy').click(function() {
          copyText($(this).attr('id') + "Text")
        })

        function copyText(element) {
          var aux = document.createElement("div");
          aux.setAttribute("contentEditable", true);
          aux.innerHTML = document.getElementById(element).innerHTML;
          aux.setAttribute("onfocus", "document.execCommand('selectAll',false,null)");
          document.getElementById('final2').appendChild(aux);
          aux.focus();
          document.execCommand("copy");
          document.getElementById('final2').removeChild(aux);
        }
        $('#specFour').change(function() {
          if ($('#specFour').prop('checked')) {
            $('#specCore').prop('checked', true);
            $('#specTouch').prop('checked', true);
            $('#specClot').prop('checked', true);
            $('#specASmear').prop('checked', true);
            $('#specPBSmear').prop('checked', false);
          }
          showDivs();
          specCheck = true;
          if (latCheck == true) {
            grossDescription();
          }
        })

        $('#specTypes').change(function() {
          showDivs();
          specCheck = true;
          if (latCheck == true) {
            grossDescription()
          }
        })

        $('#pbText').change(function() {
          $('#bloodText').html($('#pbText').val());
          $('#microscopic').show();
        })

        $('#pbDescriptors').change(function() {
          fillPB();
        })

        $('#rbcNL').change(function() {
          $('#rbcAP').prop('checked', false);
          $('#rbcPC').prop('checked', false);
          $('#anisoDiv').hide();
        })

        $('#rbcPC').change(function() {
          $('#rbcNL').prop('checked', false);
        })

        $('#rbcAP').change(function() {
          $('#rbcNL').prop('checked', false);
        })

        $('#neutNL').change(function() {
          $('#neutTC').prop('checked', false);
          $('#neutLS').prop('checked', false);
        })

        $('#neutTC').change(function() {
          $('#neutNL').prop('checked', false);
        })

        $('#neutLS').change(function() {
          $('#neutNL').prop('checked', false);
        })

        $('#aspMegNL').change(function() {
          $('#aspMegHF').prop('checked', false);
          $('#aspMegSN').prop('checked', false);
        })

        $('#aspMegHF').change(function() {
          $('#aspMegNL').prop('checked', false);
        })

        $('#aspMegSN').change(function() {
          $('#aspMegNL').prop('checked', false);
        })

        function fillPB() {
          var count = 0;
          if ($('#specPBSmear').prop('checked')) {
            var pbText = "The peripheral blood smears show "
            if (mcv < mcvLow) {
              pbText += 'microcytic '
            } else if (mcv > mcvHigh) {
              pbText += 'macrocytic '
            } else {
              pbText += 'normocytic '
            }
            if (hgb < hgbLow) {
              pbText += 'anemia'
            } else {
              pbText += 'red blood cells'
            }

            if ($('#rbcNL').prop('checked')) {
              pbText += ' with unremarkable red blood cell morphology'
            }

            if ($('#rbcPC').prop('checked')) {
              pbText += ' with polychromasia';
              if ($('#rbcAP').prop('checked')) {
                pbText += ' and anisopoikilocytosis'
                if (anisoOptionList[0] != undefined && anisoOptionList[0] != "") {
                  pbText += ' including ' + listText(finalAnisoList)
                }
                pbText += '.'
              } else {
                pbText += '.'
              }

            } else if ($('#rbcAP').prop('checked')) {
              pbText += ' with anisopoikilocytosis'
              if (anisoOptionList[0] != undefined && anisoOptionList[0] != "") {
                pbText += ' including ' + listText(finalAnisoList)
              }
              pbText += '.'
            } else {
              pbText += '.'
            }

            if ($('#pb1').val() > 0) {
              pbText += ' Nucleated red blood cells are seen.'
            }

            if ($('#pbCount').val() != "") {
              var lymphocytes = parseInt($('#pb8').val()) / 100 * wbc;
              if (lymphocytes > lymphHigh) {
                pbText += ' There is absolute lymphocytosis.'
              }
            }

            if ($('#pbCount').val() != "") {
              var neutrophils = parseInt($('#pb7').val()) / 100 * wbc;
              if (neutrophils < neutLow) {
                pbText += ' Neutrophils are decreased'
              } else if (neutrophils > neutHigh) {
                pbText += ' Neutrophils are increased'
              } else {
                pbText += ' Neutrophils are adequate'
              }

              if ($('#neutNL').prop('checked')) {
                pbText += ' with unremarkable morphology'
              } else if ($('#neutTC').prop('checked')) {
                pbText += ' and show toxic changes'
                if ($('#neutLS').prop('checked')) {
                  pbText += ' and a left shift to immaturity'
                }
              } else if ($('#neutLS').prop('checked')) {
                pbText += ' and show a left shift to immaturity'
              }
              pbText += '.'
            }

            if (plt < pltLow) {
              pbText += ' Platelets are decreased'
              if ($('#pltNL').prop('checked')) {
                pbText += ' with unremarkable morphology.'
              } else if ($('#pltLP').prop('checked')) {
                pbText += ' with occasional large platelets.'
              } else {
                pbText += '.'
              }
            } else if (plt > pltHigh) {
              pbText += ' Platelets are increased'
              if ($('#pltNL').prop('checked')) {
                pbText += ' with unremarkable morphology.'
              } else if ($('#pltLP').prop('checked')) {
                pbText += ' with occasional large platelets.'
              } else {
                pbText += '.'
              }
            } else {
              pbText += ' Platelets are adequate'
              if ($('#pltNL').prop('checked')) {
                pbText += ' with unremarkable morphology.'
              } else if ($('#pltLP').prop('checked')) {
                pbText += ' with occasional large platelets.'
              } else {
                pbText += '.'
              }
            }
          } else {
            pbText = "A peripheral blood smear is not provided for review."
          }
          $('#pbText').val(pbText);
          $('#bloodText').html($('#pbText').val() + '<br><br>');
          $('#microscopic').show();
        }

        function listText(listToConvert) {
          var listText = "";
          if (listToConvert.length == 1) {
            return listToConvert[0];
          } else if (listToConvert.length == 2) {
            return listToConvert[0] + " and " + listToConvert[1]
          } else {
            for (var i = 0; i < listToConvert.length; i++) {
              if (i != listToConvert.length - 1) {
                listText += listToConvert[i] + ", ";
              } else {
                listText += "and " + listToConvert[i];
              }
            }
          }
          return listText
        }

        $('#aspirateDiv').change(function() {
          fillAsp();
        })

        $('#aspText').change(function() {
          $('#aspirateText').html($('#aspText').val());
          $('#aspirateSmear').show();
          $('#aspirateText').show();
          $('#microscopic').show();
        })

        $('#aspText').change(function() {
          $('#aspirateText').html($('#aspText').val());
          $('#aspirateSmear').show();
          $('#aspirateText').show();
          $('#microscopic').show();
        });
        $('#aspirateText').html($('#aspText').val());

        function fillAsp() {
          var aspText = "";
          if ($('#aspAdequate').prop('checked')) {
            aspText += "The bone marrow aspirate smears are cellular and adequate for interpretation."
          }
          if ($('#aspMegAdeq').prop('checked')) {
            aspText += " Megakaryocytes are adequate"
            aspText = fillMegs(aspText);
          } else if ($('#aspMegDec').prop('checked')) {
            aspText += " Megakaryocytes are decreased"
            aspText = fillMegs(aspText);
          } else if ($('#aspMegInc').prop('checked')) {
            aspText += " Megakaryocytes are increased"
            aspText = fillMegs(aspText);
          }
          $('#aspText').val(aspText);
          $('#aspirateText').html($('#aspText').val() + '<br><br>');
          $('#aspirateSmear').show();
          $('#aspirateText').show();
          $('#microscopic').show();
        }

        function fillMegs(aspText) {
          if ($('#aspMegNL').prop('checked')) {
            aspText += " and show unremarkable morphology"
          } else if ($('#aspMegHF').prop('checked')) {
            aspText += " with hypolobated forms"
          } else if ($('#aspMegSN').prop('checked')) {
            aspText += " with separation of nuclei"
          }
          aspText += "."
          return aspText
        }

        function showDivs() {
          if ($('#specCore').prop('checked')) {
            $('#coreDiv').show();
          } else {
            $('#coreDiv').hide()
          }
          if ($('#specASmear').prop('checked')) {
            $('#aspDiv').show();
          } else {
            $('#aspDiv').hide()
          }
          if ($('#specFISH').prop('checked')) {
            $('#fishList').show();
          } else {
            $('#fishList').hide()
          }
          if ($('#specMolec').prop('checked')) {
            $('#molecList').show();
          } else {
            $('#molecList').hide()
          }
        }

        function grossDescription() {
          $('#gross').show();
          var laterality = "";
          var grossText = "";
          var headerText = "";
          var headerSpecs = [];
          var fishText = "";
          if ($('#latR').prop('checked')) {
            laterality = "right";
          } else if ($('#latL').prop('checked')) {
            laterality = "left";
          } else if ($('#latB').prop('checked')) {
            laterality = "bilateral";
          }

          if ($('#specPBSmear').prop('checked')) {
            grossText += "<br>" + "Peripheral blood smear"
            headerSpecs.push("peripheral blood smear")

            if ($('#pbCount').val() != "") {
              pbCounter();
            } else if ($('#pbCBC').val() != "") {
              fillPB();
            } else {
              $('#pbText').val("");
              $('#bloodText').html($('#pbText').val());
            }

          } else {
            $('#pbText').val("A peripheral blood smear is not provided for review.");
            $('#bloodText').html($('#pbText').val());
            $('#bloodText').show();
            $('#pbTable').hide();
            $('#diff').hide();
          }
          if ($('#specASmear').prop('checked')) {
            grossText += "<br>" + "Bone marrow aspirate, " + laterality + " posterior iliac crest"
            headerSpecs.push("bone marrow aspirate")
          }
          if ($('#aspSize').val() != "") {
            grossText += " (" + $('#aspSize').val() + " cc)"
          }
          if ($('#specClot').prop('checked')) {
            grossText += "<br>" + "Particle clot (formalin fixed)"
          }
          if ($('#specCore').prop('checked')) {
            grossText += "<br>" + "Bone marrow core biopsy, " + laterality + " posterior iliac crest "
            headerSpecs.push(laterality + " posterior iliac crest bone marrow core biopsy")
            if ($('#coreSize1').val() != "" && $('#coreSize2').val() != "") {
              grossText += " (" + $('#coreSize1').val() + " cm and " + $('#coreSize2').val() + " cm, B5 fixed)"
            } else if ($('#coreSize1').val() != "") {
              grossText += " (" + $('#coreSize1').val() + " cm, B5 fixed)"
            } else if ($('#coreSize2').val() != "") {
              grossText += " (" + $('#coreSize2').val() + " cm, B5 fixed)"
            } else {
              grossText += "(B5 fixed)"
            }
          }
          if ($('#specTouch').prop('checked')) {
            grossText += "<br>" + "Touch preparation, " + laterality
          }
          if ($('#specFlow').prop('checked')) {
            grossText += "<br>" + "Flow cytometry - Bone marrow aspirate submitted to Flow Cytometry Laboratory at Northwestern Memorial Hospital (NMH)."
          }

          if ($('#specFISH').prop('checked')) {
            if ($('#fishList').val() != 0) {
              fishText = ' for ' + $('#fishList').val()
            }
          }
          if ($('#specGen').prop('checked') && $('#specFISH').prop('checked')) {
            grossText += "<br>" + "Cytogenetics/FISH - Bone marrow aspirate submitted to Cytogenetic Laboratory at Northwestern Memorial Hospital for conventional cytogenetic studies and FISH analysis" + fishText
          } else if ($('#specGen').prop('checked')) {
            grossText += "<br>" + "Cytogenetics - Bone marrow aspirate submitted to Cytogenetic Laboratory at Northwestern Memorial Hospital for conventional cytogenetic studies"
          } else if ($('#specFISH').prop('checked')) {
            grossText += "<br>" + "FISH - Bone marrow aspirate submitted to Cytogenetic Laboratory at Northwestern Memorial Hospital for FISH analysis" + fishText
          }

          if ($('#specMolec').prop('checked')) {
            grossText += "<br>" + "Molecular testing: Bone marrow aspirate submitted to the molecular laboratory at NMH"
            if ($('#molecList').val() != 0) {
              grossText += " for " + $('#molecList').val()
            }
          }
          $("#grossText").html(grossText);
          for (var i = 0; i < headerSpecs.length; i++) {
            if (i == 0) {
              headerText += headerSpecs[0];
            } else if (i == headerSpecs.length - 1 && headerSpecs.length > 2) {
              headerText += ", and " + headerSpecs[i];
            } else if (i == headerSpecs.length - 1 && headerSpecs.length == 2) {
              headerText += " and " + headerSpecs[i];
            } else {
              headerText += ", " + headerSpecs[i];
            }
          }
          headerText += ":";

          $("#header").html(headerText.charAt(0).toUpperCase() + headerText.slice(1) + "<br>" + "<br>");
          $('#final').show();
        }

        $('#specTypes').change(function() {
          if ($('#specCore').prop('checked') && $('#specTouch').prop('checked') && $('#specClot').prop('checked') && $('#specASmear').prop('checked') && $('#specPBSmear').prop('checked') && $('#specFlow').prop('checked') && $('#specGen').prop('checked') && $('#specFISH').prop('checked') && $('#specMolec').prop('checked')) {
            $('#specFive').prop('checked', true)
          } else if ($('#specCore').prop('checked') && $('#specTouch').prop('checked') && $('#specClot').prop('checked') && $('#specASmear').prop('checked')) {
            $('#specFour').prop('checked', true)
          } else {
            $('#specFive').prop('checked', false);
            $('#specFour').prop('checked', false);
          }
        })

        $('#chText').keyup(function() {
          $('#clinical').show();
          $("#clinicalHistory").html($('#chText').val() + "<br><br>")
        })

        $('#pbDCount').change(function() {
          if ($('#pbDCount').val() == "") {
            var desiredCount = $('#pbDCount').attr('placeholder');
          } else {
            var desiredCount = $('#pbDCount').val()
          }
          $('#pbTableCountHeader').html('Peripheral blood (' + desiredCount + ' cells)');
          pbCounter();
        })

        $('#pbCountTable').change(function() {
          var totalVar = 0;
          $('.pbCellType').each(function() {
            if ($('#' + this.id).html().indexOf('NRBC') != -1) {
              $('#' + this.id.replace('Label', '')).val(parseFloat($('#' + this.id.replace('Label', '')).val().replace(/%/g, '')))
            } else {
              $('#' + this.id.replace('Label', '')).val(parseFloat($('#' + this.id.replace('Label', '')).val().replace(/%/g, '')).toFixed(1) + "%")
              totalVar += parseFloat($('#' + this.id.replace('Label', '')).val().replace(/%/g, ''))
            }
          })

          $('#pbTotalPercent').val(totalVar + "%");
          $('#pbNeutTable').html($('#pb7').val());
          $('#pbLymphTable').html($('#pb8').val());
          $('#pbMonoTable').html($('#pb9').val());
          $('#pbEoTable').html($('#pb4').val());
          $('#pbBasoTable').html($('#pb5').val());
          $('#pbPlasmaTable').html($('#pb6').val());
          $('#pbNRBCTable').html($('#pb1').val());
          $('#pbBlastTable').html($('#pb0').val());
        })

        $('#pbCount').keydown(function(e) {
          if (window.keypressed[e.which]) {
            e.preventDefault();
          } else {
            window.keypressed[e.which] = true;
            new Audio(countAudio).play()
          }
        })

        $('#pbCount').keyup(function(e) {
          window.keypressed[e.which] = false;
          pbCounter();
        })

        $('#rbcAP').change(function() {
          if ($('#rbcAP').prop('checked')) {
            createAniso();
            $('#anisoDiv').show()
          } else {
            $('#anisoDiv').hide()
          }
        })

        $('#anisoDiv').change(function() {
          createAniso()
        })

        function createAniso() {
          var anisoList = ['', 'acanthocytes', 'basophilic stippling', 'burr cells', 'Howell-Jolly bodies', 'macrocytes', 'macroovalocytes', 'microcytes', 'ovalocytes', 'schistocytes', 'spherocytes', 'target cells', 'teardrop forms']
          anisoOptionList = [];
          finalAnisoList = [];
          var count = 0;
          var testVar = ""
          $('.aniso').each(function() {
            if (anisoOptionList.indexOf($('#' + this.id).val()) == -1) {
              anisoOptionList.push($('#' + this.id).val())
            }
          })
          for (var i = 0; i < anisoOptionList.length; i++) {
            if (anisoOptionList[i] != '') {
              testVar += '<div><select id="aniso' + count + '" class="aniso">'
              for (var j = 0; j < anisoList.length; j++) {
                testVar += '<option value="' + anisoList[j] + '"'
                if (anisoList[j] == anisoOptionList[i]) {
                  testVar += ' selected'
                }
                testVar += '>' + anisoList[j].charAt(0).toUpperCase() + anisoList[j].slice(1) + '</option>';
              }
              anisoList.splice($.inArray(anisoOptionList[i], anisoList), 1);
              testVar += '</select>&nbsp<label><input type="radio" name="anisoQuant' + count + '" id="anisoFreq' + count + '"'
              if ($('#anisoFreq' + count).prop('checked')) {
                testVar += ' checked'
              }
              testVar += '> Frequent</label>';
              testVar += '</select>&nbsp<label><input type="radio" name="anisoQuant' + count + '" id="anisoOccas' + count + '"'
              if ($('#anisoOccas' + count).prop('checked')) {
                testVar += ' checked'
              }
              testVar += '> Occasional</label>';
              testVar += '</select>&nbsp<label><input type="radio" name="anisoQuant' + count + '" id="anisoRare' + count + '"'
              if ($('#anisoRare' + count).prop('checked')) {
                testVar += ' checked';
              }
              testVar += '> Rare</label></div>';

              if ($('#anisoFreq' + count).prop('checked')) {
                finalAnisoList.push('frequent ' + anisoOptionList[i]);
              } else if ($('#anisoOccas' + count).prop('checked')) {
                finalAnisoList.push('occasional ' + anisoOptionList[i]);
              } else if ($('#anisoRare' + count).prop('checked')) {
                finalAnisoList.push('rare ' + anisoOptionList[i]);
              } else {
                finalAnisoList.push(anisoOptionList[i]);
              }
            }
            count++;
          }
          testVar += '<div><select id="aniso' + count + '" class="aniso">'
          for (var i = 0; i < anisoList.length; i++) {
            testVar += '<option value="' + anisoList[i] + '"'
            testVar += '>' + anisoList[i].charAt(0).toUpperCase() + anisoList[i].slice(1) + '</option>';
          }
          testVar += '</select></div>';
          count++;
          $('#anisoDiv').html(testVar);
        }

        function pbCounter() {
        $('#specPBSmear').prop('checked', true);
          if ($('#pbDCount').val() == "") {
            var desiredCount = $('#pbDCount').attr('placeholder');
          } else {
            var desiredCount = $('#pbDCount').val()
          }
          var totalVar = 0
          var re = new RegExp("(?!"+ + pbTypeList.indexOf('NRBCs') + ")\\d","g")
          var totalCells = ($('#pbCount').val().match(re) || []).length;
          
          if (totalCells != 0) {
            $('.pbCellType').each(function() {
         
              var tempID = this.id.replace('Label', '')
              var tempNumber = tempID.replace('pb', '')
              var re = new RegExp(tempNumber, 'g');
                 console.log('#pb' + pbTypeList[tempNumber] + 'Table')
              if ($(this).html().indexOf('NRBC') != -1) {
                $('#' + tempID).val((($('#pbCount').val().match(re) || []).length / (totalCells / 100)).toFixed(0));
                $('#pb' + pbTypeList[tempNumber] + 'Table').html($('#' + tempID).val());
              } else {
                var tempPercent = (Math.round(($('#pbCount').val().match(re) || []).length / totalCells * desiredCount) / (desiredCount / 100)).toFixed(1)
                $('#' + tempID).val(tempPercent + "%");
                $('#pb' + pbTypeList[tempNumber] + 'Table').html(tempPercent + "%");
               totalVar += parseFloat($('#'+tempID).val().replace(/%/g, ''))
              }              
            })
          }
          if ($('#pbCount').val().indexOf(pbTypeList.indexOf('Blasts')) != -1) {
            $('#pbBlastRow').show();
          } else {
          $('#pbBlastRow').hide();
          }
          
          if ($('#pbCount').val().indexOf(pbTypeList.indexOf('NRBCs')) != -1) {
            $('#pbNRBCRow').show();
          } else {
          $('#pbNRBCRow').hide();
          }
          
          if ($('#pbCount').val().indexOf(pbTypeList.indexOf('Atypical')) != -1) {
            $('#pbAtypicalRow').show();
          } else {
          $('#pbAtypicalRow').hide();
          }
          
          if ($('#pbCount').val().indexOf(pbTypeList.indexOf('Plasma')) != -1) {
            $('#pbPlasmaRow').show();
          } else {
          $('#pbPlasmaRow').hide();
          }
          
          if (totalCells == desiredCount) {
            new Audio(finishedAudio).play()

          } else if (totalCells != 0 && totalCells % 100 == 0) {
            new Audio(hundredAudio).play()
          }
         
          $('#pbTotalPercent').val(totalVar.toFixed(1) + "%");
          $('#pbTableCountHeader').html('Peripheral blood (' + desiredCount + ' cells)');
          $('#microscopic').show();
          $('#diff').show();
          $('#pbTable').show();
          $('#pbCCount').val(totalCells);
          if ($('#pbCBC').val() != "") {
            fillPB();
          }
          if ($('#pbPerformed').val() != "") {
            $('#performedText').html('Performed by:   ' + $('#pbPerformed').val() + '<br><br>')
          }
        }

        $('#aspCount').keydown(function(e) {
          if (window.keypressed[e.which]) {
            e.preventDefault();
          } else {
            window.keypressed[e.which] = true;
            new Audio(countAudio).play()
          }
        })

        $('#aspCount').keyup(function(e) {
          window.keypressed[e.which] = false;
          aspCounter();
        })

        $('#aspDCount').change(function() {
          if ($('#aspDCount').val() == "") {
            var desiredCount = $('#aspDCount').attr('placeholder');
          } else {
            var desiredCount = $('#aspDCount').val()
          }
          $('#aspTableCountHeader').html('Aspirate Smear (' + desiredCount + ' cells)');
          aspCounter();
        })
        $('#aspCountTable').change(function() {
          var totalVar = 0;
          $('.aspCellType').each(function() {
            if ($(this).html().indexOf('NRBC') != -1) {
              $('#' + this.id.replace('Label', '')).val(parseFloat($('#' + this.id.replace('Label', '')).val().replace(/%/g, '')))
            } else {
              $('#' + this.id.replace('Label', '')).val(parseFloat($('#' + this.id.replace('Label', '')).val().replace(/%/g, '')).toFixed(1) + "%")
              totalVar += parseFloat($('#' + this.id.replace('Label', '')).val().replace(/%/g, ''))
            }
          })
          if ($('#asp4').val() != "0.0%") {
            $('#meRatio').val(((parseFloat($('#asp1').val().replace(/%/g, '')) + parseFloat($('#asp7').val().replace(/%/g, '')) + parseFloat($('#asp8').val().replace(/%/g, '')) + parseFloat($('#asp9').val().replace(/%/g, ''))) / parseFloat($('#asp4').val().replace(/%/g, ''))).toFixed(1) + ":1")
          } else {
            $('#meRatio').val('-')
          }
          $('#aspTotalPercent').val(totalVar.toFixed(1) + "%");
          $('#aspNeutTable').html($('#asp7').val());
          $('#aspEoTable').html($('#asp8').val());
          $('#aspMonoTable').html($('#asp9').val());
          $('#aspNRBCTable').html($('#asp4').val());
          $('#aspLymphTable').html($('#asp5').val());
          $('#aspPlasmaTable').html($('#asp6').val());
          $('#aspBasoTable').html($('#asp1').val());
          $('#aspBlastTable').html($('#asp0').val());
          $('#aspMETable').html($('#meRatio').val())
        })

        function aspCounter() {
          if ($('#aspDCount').val() == "") {
            var desiredCount = $('#aspDCount').attr('placeholder');
          } else {
            var desiredCount = $('#aspDCount').val()
          }
          var totalCells = ($('#aspCount').val().match(/[0-9]/g) || []).length;
          $('#aspCCount').val(totalCells);
          if (totalCells != 0) {
            $('.aspCellType').each(function() {
              var tempID = this.id.replace('Label', '')
              var tempNumber = tempID.replace('asp', '')
              var re = new RegExp(tempNumber, 'g');
                var tempPercent = (Math.round(($('#aspCount').val().match(re) || []).length / totalCells * desiredCount) / (desiredCount / 100)).toFixed(1)
                $('#' + tempID).val(tempPercent + "%");
                $('#asp' + aspTypeList[tempNumber] + 'Table').html(tempPercent + "%");
               totalVar += parseFloat($('#'+tempID).val().replace(/%/g, ''))
                            
            })
          }
          if (($('#aspCount').val().match(/4/g) || []).length != 0) {
            $('#meRatio').val(((($('#aspCount').val().match(/[7-9]|1/g) || []).length / ($('#aspCount').val().match(/4/g) || []).length).toFixed(1)) + ":1")
          } else {
            $('#meRatio').val('-')
          }
          var totalVar = parseFloat($('#asp0').val().replace(/%/g, '')) + parseFloat($('#asp1').val().replace(/%/g, '')) + parseFloat($('#asp2').val().replace(/%/g, '')) + parseFloat($('#asp3').val().replace(/%/g, '')) + parseFloat($('#asp4').val().replace(/%/g, '')) + parseFloat($('#asp5').val().replace(/%/g, '')) + parseFloat($('#asp6').val().replace(/%/g, '')) + parseFloat($('#asp7').val().replace(/%/g, '')) + parseFloat($('#asp8').val().replace(/%/g, '')) + parseFloat($('#asp9').val().replace(/%/g, ''));
          $('#aspTotalPercent').val(totalVar.toFixed(1) + "%");
          if (totalCells == desiredCount) {
            new Audio(finishedAudio).play()
          } else if (totalCells != 0 && totalCells % 100 == 0) {
            new Audio(hundredAudio).play()
          }
          $('#aspTableCountHeader').html('Aspirate Smear (' + desiredCount + ' cells)')
          $('#aspMETable').html($('#meRatio').val());
          $('#microscopic').show();
          $('#diff').show();
          $('#aspTable').show();
          if ($('#pbPerformed').val() != "") {
            $('#performedText').html('Performed by:   ' + $('#pbPerformed').val() + '<br><br>')
          }
        }

        $('#ironStainDiv').change(function() {
          var ironText = "";
          if ($('#ironStain').prop('checked')) {
            if ($('#ironStainInc').prop('checked')) {
              ironText += "There is increased storage iron.";
            } else if ($('#ironStainAdeq').prop('checked')) {
              ironText += "There is adequate storage iron.";
            } else if ($('#ironStainDec').prop('checked')) {
              ironText += "There is decreased storage iron.";
            }
            if ($('#ringPresent').prop('checked')) {
              ironText += " Ring sideroblasts are identified.";
            } else if ($('#ringAbsent').prop('checked')) {
              ironText += " No ring sideroblasts are identified.";
            }
            $('#ssIronTable').html(ironText);
            $('#microscopic').show();
            $('#specialStains').show();
          }
        })

        $('#pbCBC').on('keyup change', function() {
          var cbcFinal = [];
          var cbcToggle = 0;
          var cbcLines = "";
          var cbcUnit = "";
          var collectedDate = "";
          var cbcText = ""
          var cbcHeader = ""
          var cbc = [
            [" K/uL", "WBC", "WHITE BLOOD CELLS"],
            [" g/dL", "HGB", "HEMOGLOBIN", "HEMOGLOBIN, BLOOD"],
            ["%", "HCT", "HEMATOCRIT, BLOOD"],
            [" fL", "MCV"],
            ["%", "RDW", "RBC DIST WIDTH"],
            [" K/uL", "PLT", "PLT CNT", "PLATELETS, BLOOD"]
          ];
          var cbcLines = $('#pbCBC').val().split("\n")
          var pbText = ""
          for (var i = 0; i < cbcLines.length; i++) {
            cbcFinal.push(cbcLines[i].split("\t"))
          }
          for (var i = 0; i < cbcFinal.length; i++) {
            for (var j = 0; j < cbcFinal[i].length; j++) {
              cbcFinal[i][j] = cbcFinal[i][j].trim();
              if (cbcFinal[i][0].replace(/\s/g, '') == "WBC" || cbcFinal[i][0].replace(/\s/g, '').indexOf('WHITE BLOOD CELLS') != -1) {
                if (cbcFinal[i][j].indexOf("-") == -1 && /\d/.test(cbcFinal[i][j])) {
                  wbc = parseFloat(cbcFinal[i][j].replace(/[^\d.-]/g, ''));
                } else if (cbcFinal[i][j].indexOf("-") != -1) {
                  wbcLow = parseFloat(cbcFinal[i][j].split(" ")[0])
                  wbcHigh = parseFloat(cbcFinal[i][j].split(" ")[2])
                }
              }

              if (cbcFinal[i][0].replace(/\s/g, '') == "HGB") {
                if (cbcFinal[i][j].indexOf("-") == -1 && /\d/.test(cbcFinal[i][j])) {
                  hgb = parseFloat(cbcFinal[i][j].replace(/[^\d.-]/g, ''));
                } else if (cbcFinal[i][j].indexOf("-") != -1) {
                  hgbLow = parseFloat(cbcFinal[i][j].split(" ")[0])
                  hgbHigh = parseFloat(cbcFinal[i][j].split(" ")[2])
                }
              } else if (cbcFinal[i][0].replace(/\s/g, '') == "PLT") {
                if (cbcFinal[i][j].indexOf("-") == -1 && /\d/.test(cbcFinal[i][j])) {
                  plt = parseInt(cbcFinal[i][j].replace(/[^\d.-]/g, ''));
                } else if (cbcFinal[i][j].indexOf("-") != -1) {
                  pltLow = parseFloat(cbcFinal[i][j].split(" ")[0])
                  pltHigh = parseFloat(cbcFinal[i][j].split(" ")[2])
                }
              } else if (cbcFinal[i][0].replace(/\s/g, '') == "MCV") {
                if (cbcFinal[i][j].indexOf("-") == -1 && /\d/.test(cbcFinal[i][j])) {
                  mcv = parseFloat(cbcFinal[i][j].replace(/[^\d.-]/g, ''));
                } else if (cbcFinal[i][j].indexOf("-") != -1) {
                  mcvLow = parseFloat(cbcFinal[i][j].split(" ")[0])
                  mcvHigh = parseFloat(cbcFinal[i][j].split(" ")[2])
                }
              }
              if (cbcFinal[i][0].indexOf("Absolute Lymphocytes") != -1) {
                if (cbcFinal[i][j].indexOf("-") != -1) {
                  lymphLow = parseFloat(cbcFinal[i][j].split(" ")[0])
                  lymphHigh = parseFloat(cbcFinal[i][j].split(" ")[2])
                }
              }

              if (cbcFinal[i][0].indexOf("Absolute Neutrophils") != -1 || cbcFinal[i][0].indexOf("GRAN #") != -1) {
                if (cbcFinal[i][j].indexOf("-") != -1) {
                  neutLow = parseFloat(cbcFinal[i][j].split(" ")[0])
                  neutHigh = parseFloat(cbcFinal[i][j].split(" ")[2])
                }
              }

              if (cbcFinal[i].indexOf('Resulting Agency') != -1) {
                if (cbcFinal[i].indexOf('NMH') != -1) {
                  var laboratory = "Northwestern Memorial Hospital"
                } else if (cbcFinal[i].indexOf('MISYS') != -1) {
                  var laboratory = "Lurie Children's Hospital of Chicago";
                } else {
                  var laboratory = cbcFinal[i][j];
                }
              }

              if (cbcFinal[i][j].indexOf("Specimen Collected:") != -1) {
                var cbcTemp = cbcFinal
                collectedDate = cbcTemp[i][j].split(" ")[2]
                cbcHeader = "The following CBC is from " + collectedDate + " and was performed at " + laboratory + ":" + "<br>" + "<br>"
              }
            }
            for (var y = 0; y < cbc.length; y++) {
              if (cbc[y].indexOf(cbcFinal[i][0]) != -1) {
                for (var j = 0; j < cbcFinal[i].length; j++) {
                  if (cbcFinal[i][j].indexOf("-") != -1) {
                    cbcUnit = " " + cbcFinal[i][j].replace(/[\d\.\s-]/g, '');
                    if (cbcUnit.indexOf("%") != -1) {
                      cbcUnit = cbcUnit.replace(/\s/g, '');
                    }
                  }
                  if (cbcFinal[i][j].indexOf("-") == -1 && cbcToggle == 0 && /\d/.test(cbcFinal[i][j])) {
                    if (cbc[cbc.length - 1].indexOf(cbcFinal[i][0]) != -1) {
                      cbcText += cbc[y][1] + " " + cbcFinal[i][j].replace(/[^\d.-]/g, '') + cbc[y][0] + ".";
                      cbcToggle = 1;
                    } else {

                      cbcText += cbc[y][1] + " " + cbcFinal[i][j].replace(/[^\d.-]/g, '') + cbc[y][0] + "; ";
                      cbcToggle = 1;
                    }
                  }
                }
                cbcToggle = 0;
              }
            }
          }
          $("#clinicalCBC").html(cbcHeader + cbcText);
          $('#clinical').show();
          $('#clinicalCBC').show();
          $('#peripheralBlood').show();
          fillPB();
        })

        $('#saveAll').click(function() {
          if ($('#savePerformed').val() != "") {
            localStorage.setItem("performedName", $('#savePerformed').val());
            $('#pbPerformed').val($('#savePerformed').val());
          }
          if ($('#themeColor').val() != "") {
            localStorage.setItem("themeColor", $('#themeColor').val());
          }
          $('.pbCellTypeSave').each(function(){
          if ($(this).val() == ""){
          pbTypeList[this.id.replace('pbSave',"")] = $(this).attr('placeholder')
          } else {
          pbTypeList[this.id.replace('pbSave',"")] = $(this).val() 
          }
          })
          localStorage.setItem("pbTypeList", JSON.stringify(pbTypeList));
          pbTypeListChange(pbTypeList)
        })

        function changeTheme(newThemeColor) {
          $(".banner").css("background-color", newThemeColor);
          $(".btn").css("background-color", newThemeColor);
          $(".btn").css("border-color", newThemeColor);
          $(".panel-heading").css("background-color", newThemeColor);
          $(".panel").css("border-color", newThemeColor);
          $(".panel-heading").css("border-color", newThemeColor);
        }

        $('#themeColor').change(function() {
          changeTheme($('#themeColor').val());
        })

        $('#fcText').keyup(function() {
          var dotFlow = [
            ["chronicneg", "Flow cytometric immunophenotyping performed on the bone marrow aspirate reveals a polytypic B-cell population and a T-cell population without evidence of immunophenotypic abnormality based on the markers assayed."],
            ["ballneg", "Flow cytometric immunophenotyping performed on the bone marrow aspirate reveals no immunophenotypic evidence of an abnormal B lymphoblast population"]
          ]
          for (var i = 0; i < dotFlow.length; i++) {
            if ($('#fcText').val().indexOf("." + dotFlow[i][0] + " ") != -1) {
              $('#fcText').val($('#fcText').val().replace("." + dotFlow[i][0] + " ", dotFlow[i][1]))
            }
          }
        })

        $('#flowHelp').click(function() {
        
        togglePanel('flowHelpScreen')
        
        })
      });

    </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  </body>
</html>
